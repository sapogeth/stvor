# ‚úÖ STVOR MESSENGER - –ó–ê–ü–£–©–ï–ù –ù–ê LOCALHOST

**–î–∞—Ç–∞:** 2025-11-03  
**–°—Ç–∞—Ç—É—Å:** üü¢ –†–ê–ë–û–¢–ê–ï–¢

---

## üìç –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –°–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | URL | –°—Ç–∞—Ç—É—Å |
|--------|-----|--------|
| **Relay Server** | http://localhost:3001 | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| **Web Frontend** | http://localhost:3002 | ‚ö†Ô∏è –ù—É–∂–Ω—ã Clerk –∫–ª—é—á–∏ |

---

## ‚úÖ –ß—Ç–æ –†–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ Relay Server (Fastify) –Ω–∞ –ø–æ—Ä—Ç—É 3001
- ‚úÖ In-Memory storage (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è localhost
- ‚úÖ JWT —Å–µ–∫—Ä–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Next.js dev server –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3002
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (pnpm)
- ‚úÖ TypeScript —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Webpack dev server —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚ö†Ô∏è –ß—Ç–æ –ù—É–∂–Ω–æ –î–æ–¥–µ–ª–∞—Ç—å

### 1. –ü–æ–ª—É—á–∏—Ç—å Clerk –ö–ª—é—á–∏ (–û–°–ù–û–í–ù–û–ï)

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Publishable key not valid"

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://dashboard.clerk.com/sign-up
2. –°–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
3. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "Stv0r Messenger"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–≤–∞ –∫–ª—é—á–∞:
   - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pk_test_`)
   - `CLERK_SECRET_KEY` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_test_`)

**–í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª:**
```bash
apps/web/.env.local
```

**–ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:**
```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_placeholder  # ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π
CLERK_SECRET_KEY=sk_test_placeholder                   # ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–π
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Frontend

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π:
```bash
killall -9 node
cd apps/web && pnpm dev
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è Clerk –∫–ª—é—á–µ–π –≤—ã —Å–º–æ–∂–µ—Ç–µ:

1. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Clerk
2. ‚úÖ –í–æ–π—Ç–∏ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
3. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å quantum-resistant –∫–ª—é—á–∏ (X25519 + ML-KEM-768)
4. ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å E2E –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Safety Numbers
6. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Double Ratchet

---

## üìÅ –í–∞–∂–Ω—ã–µ –§–∞–π–ª—ã

```
/Users/ilaszajsenbaev/ilyazh-messenger/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ relay/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .env              ‚Üê Relay config (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dist/index.js     ‚Üê –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π relay
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îî‚îÄ‚îÄ .env.local        ‚Üê ‚ö†Ô∏è –û–±–Ω–æ–≤–∏—Ç–µ Clerk –∫–ª—é—á–∏ –ó–î–ï–°–¨
‚îú‚îÄ‚îÄ START.md                  ‚Üê –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ DEPLOY.md                 ‚Üê Production deployment
‚îî‚îÄ‚îÄ LOCALHOST_RUNNING.md      ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ .gitignore:**
- `apps/web/.env.local` - –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è
- `apps/relay/.env` - –ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è
- Supabase password - —Ç–æ–ª—å–∫–æ –≤ env —Ñ–∞–π–ª–∞—Ö
- JWT secret - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ

**‚ö†Ô∏è –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ git:**
- –§–∞–π–ª—ã `.env*`
- Clerk –∫–ª—é—á–∏
- Supabase credentials

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –î–µ–π—Å—Ç–≤–∏—è

**–®–∞–≥ 1:** –ü–æ–ª—É—á–∏—Ç—å Clerk –∫–ª—é—á–∏ (2 –º–∏–Ω—É—Ç—ã)
```
üëâ https://dashboard.clerk.com/sign-up
```

**–®–∞–≥ 2:** –û–±–Ω–æ–≤–∏—Ç—å `apps/web/.env.local`

**–®–∞–≥ 3:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å frontend
```bash
killall -9 node
cd apps/web && pnpm dev
```

**–®–∞–≥ 4:** –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä
```
üëâ http://localhost:3002
```

**–®–∞–≥ 5:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ! üîê

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ relay
curl http://localhost:3001/healthz

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:3001/metrics

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ relay
cat /tmp/relay.log

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
killall -9 node

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ relay
NODE_ENV=development \
STORAGE_TYPE=memory \
JWT_SECRET="0jb8vV95MkIvsRfECDyXKDmpOl+qwapI+5fhIWSL4xC2LSYLSUsAUnloktqP5PQP" \
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:3002" \
ALLOW_DEV_AUTOCREATE=1 \
node apps/relay/dist/index.js > /tmp/relay.log 2>&1 &
```

---

## üöÄ Production Deployment

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –¥–µ–ø–ª–æ–∏—Ç—å –≤ production:
```
üìñ –°–º. DEPLOY.md –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
```

---

**‚ú® –í–∞—à quantum-resistant E2EE messenger –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

**–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ Clerk –∫–ª—é—á–∏ –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è! üîê**
